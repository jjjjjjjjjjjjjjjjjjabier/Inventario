<UserControl x:Class="InventarioComputo.UI.Views.ReportesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:conv="clr-namespace:InventarioComputo.UI.Converters"
             mc:Ignorable="d"
             d:DesignHeight="650" d:DesignWidth="950"
             Loaded="UserControl_Loaded">

    <UserControl.Resources>
        <conv:ActiveStatusConverter x:Key="ActiveStatusConverter"/>
        <conv:BoolToStringConverter x:Key="BoolToStringConverter"/>
        <conv:ObjectToVisibilityConverter x:Key="ObjectToVisibilityConverter"/>
        <!-- Añadidos para corregir habilitación y overlay -->
        <conv:NotNullConverter x:Key="NotNullConverter"/>
        <conv:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Encabezado -->
        <Border Grid.Row="0" Background="#F5F7FA" BorderBrush="#E1E5EB" BorderThickness="0,0,0,1" Padding="24,16">
            <TextBlock Text="Reportes y Consultas" FontSize="22" FontWeight="Medium" Foreground="#2C3E50"/>
        </Border>

        <!-- Filtros -->
        <Border Grid.Row="1" Background="White" BorderBrush="#E1E5EB" BorderThickness="0,0,0,1" Padding="24,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Fila 1 -->
                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,8,10">
                    <TextBlock Text="Tipo de Equipo" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <ComboBox ItemsSource="{Binding TiposEquipo}"
                              SelectedItem="{Binding TipoEquipoSeleccionado}"
                              DisplayMemberPath="Nombre"
                              Padding="8,6"/>
                </StackPanel>

                <StackPanel Grid.Row="0" Grid.Column="1" Margin="8,0,8,10">
                    <TextBlock Text="Estado" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <ComboBox ItemsSource="{Binding Estados}"
                              SelectedItem="{Binding EstadoSeleccionado}"
                              DisplayMemberPath="Nombre"
                              Padding="8,6"
                              IsEditable="False"/>
                </StackPanel>

                <StackPanel Grid.Row="0" Grid.Column="2" Margin="8,0,0,10">
                    <TextBlock Text="Ubicación - Sede" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <ComboBox ItemsSource="{Binding Sedes}"
                              SelectedItem="{Binding SedeSeleccionada}"
                              DisplayMemberPath="Nombre"
                              Padding="8,6"
                              IsEditable="False"/>
                </StackPanel>

                <!-- Fila 2 -->
                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,8,10">
                    <TextBlock Text="Área" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <ComboBox ItemsSource="{Binding Areas}"
                              SelectedItem="{Binding AreaSeleccionada}"
                              DisplayMemberPath="Nombre"
                              Padding="8,6"
                              IsEditable="False"
                              IsEnabled="{Binding SedeSeleccionada, Converter={StaticResource NotNullConverter}}"/>
                </StackPanel>

                <StackPanel Grid.Row="1" Grid.Column="1" Margin="8,0,8,10">
                    <TextBlock Text="Zona" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <ComboBox ItemsSource="{Binding Zonas}"
                              SelectedItem="{Binding ZonaSeleccionada}"
                              DisplayMemberPath="Nombre"
                              Padding="8,6"
                              IsEditable="False"
                              IsEnabled="{Binding AreaSeleccionada, Converter={StaticResource NotNullConverter}}"/>
                </StackPanel>

                <StackPanel Grid.Row="1" Grid.Column="2" Margin="8,0,0,10">
                    <TextBlock Text="Empleado" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <ComboBox ItemsSource="{Binding Empleados}"
                              SelectedItem="{Binding EmpleadoSeleccionado}"
                              DisplayMemberPath="NombreCompleto"
                              Padding="8,6"
                              IsEditable="False"/>
                </StackPanel>

                <!-- Fila 3 -->
                <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,0,8,0">
                    <TextBlock Text="Fecha Desde" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <DatePicker SelectedDate="{Binding FechaDesde}" Padding="8,6"/>
                </StackPanel>

                <StackPanel Grid.Row="2" Grid.Column="1" Margin="8,0,8,0">
                    <TextBlock Text="Fecha Hasta" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <DatePicker SelectedDate="{Binding FechaHasta}" Padding="8,6"/>
                </StackPanel>

                <StackPanel Grid.Row="2" Grid.Column="2" Margin="8,0,0,0" Orientation="Horizontal" VerticalAlignment="Bottom">
                    <CheckBox Content="Incluir inactivos"
                              IsChecked="{Binding IncluirInactivos}"
                              VerticalAlignment="Center"
                              Margin="0,0,16,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Resultados -->
        <Border Grid.Row="2"
                Margin="24,16,24,16"
                BorderThickness="1"
                BorderBrush="#E1E5EB"
                CornerRadius="6"
                Background="White"
                Padding="1">
            <DataGrid ItemsSource="{Binding Resultados}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      HeadersVisibility="Column"
                      GridLinesVisibility="Horizontal"
                      RowBackground="White"
                      AlternatingRowBackground="#F9FAFC"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      CanUserReorderColumns="True"
                      CanUserResizeRows="False"
                      CanUserSortColumns="True"
                      BorderThickness="0"
                      SelectionMode="Single"
                      SelectionUnit="FullRow">
                <DataGrid.Resources>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="#F5F7FA"/>
                        <Setter Property="Foreground" Value="#2C3E50"/>
                        <Setter Property="FontWeight" Value="SemiBold"/>
                        <Setter Property="Padding" Value="10,12"/>
                        <Setter Property="BorderThickness" Value="0,0,0,1"/>
                        <Setter Property="BorderBrush" Value="#E1E5EB"/>
                    </Style>
                    <Style TargetType="DataGridRow">
                        <Setter Property="Height" Value="40"/>
                    </Style>
                    <Style TargetType="DataGridCell">
                        <Setter Property="Padding" Value="10,8"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="VerticalAlignment" Value="Center"/>
                    </Style>
                </DataGrid.Resources>
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Num. Serie" Binding="{Binding NumeroSerie}" Width="120"/>
                    <DataGridTextColumn Header="Etiqueta" Binding="{Binding EtiquetaInventario}" Width="120"/>
                    <DataGridTextColumn Header="Marca" Binding="{Binding Marca}" Width="100"/>
                    <DataGridTextColumn Header="Modelo" Binding="{Binding Modelo}" Width="100"/>
                    <DataGridTextColumn Header="Tipo" Binding="{Binding TipoEquipo}" Width="120"/>
                    <DataGridTextColumn Header="Estado" Binding="{Binding Estado}" Width="100"/>
                    <DataGridTextColumn Header="Asignado a" Binding="{Binding UsuarioAsignado}" Width="160"/>
                    <DataGridTextColumn Header="Ubicación" Binding="{Binding Ubicacion}" Width="170"/>
                    <!-- Nuevas columnas coherentes con los exports -->
                    <DataGridTextColumn Header="Adquisición" Binding="{Binding FechaAdquisicion, StringFormat='{}{0:dd/MM/yyyy}'}" Width="110"/>
                    <!-- Costo eliminado -->
                    <DataGridTemplateColumn Header="Activo" Width="80">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Activo, Converter={StaticResource BoolToStringConverter}}"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- Acciones -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,24,24">
            <Button Content="Limpiar Filtros" Command="{Binding LimpiarFiltrosCommand}" Padding="16,8" Margin="0,0,8,0"
                    Background="#F0F2F5" Foreground="#2C3E50" BorderThickness="1" BorderBrush="#D1D5DB">
                <Button.Resources>
                    <Style TargetType="Border"><Setter Property="CornerRadius" Value="4"/></Style>
                </Button.Resources>
            </Button>

            <Button Content="Generar Reporte" Command="{Binding GenerarReporteCommand}" Padding="16,8" Margin="0,0,8,0"
                    Background="#3498DB" Foreground="White" BorderThickness="0">
                <Button.Resources>
                    <Style TargetType="Border"><Setter Property="CornerRadius" Value="4"/></Style>
                </Button.Resources>
            </Button>

            <Button Content="Exportar a PDF" Command="{Binding ExportarPdfCommand}" Padding="16,8" Margin="0,0,8,0"
                    Background="#8E44AD" Foreground="White" BorderThickness="0">
                <Button.Resources>
                    <Style TargetType="Border"><Setter Property="CornerRadius" Value="4"/></Style>
                </Button.Resources>
            </Button>

            <Button Content="Exportar a Excel" Command="{Binding ExportarExcelCommand}" Padding="16,8"
                    Background="#27AE60" Foreground="White" BorderThickness="0">
                <Button.Resources>
                    <Style TargetType="Border"><Setter Property="CornerRadius" Value="4"/></Style>
                </Button.Resources>
            </Button>
        </StackPanel>

        <!-- Overlay de carga -->
        <Grid Grid.Row="0" Grid.RowSpan="4"
              Background="#80000000"
              Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border Padding="20" BorderThickness="1" BorderBrush="#E1E5EB" CornerRadius="6" Background="White">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <TextBlock Text="Generando reporte..." FontSize="16" Margin="0,0,0,12"/>
                    <ProgressBar IsIndeterminate="True" Height="4" Width="200"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>